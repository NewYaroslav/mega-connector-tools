# Документация Bridge REST API

## Описание
Этот API предоставляет возможность подключения торгового бота MegaConnector к ваши приложениям, в частности к MetaTrader посредством HTTP запросов. Он предназначен для разработчиков для автоматизации торговли бинарными опционами или фиксированными контрактами.

## Базовые URLs
Вы можете получить доступ к API, используя HTTP или HTTPS, в зависимости от конфигурации вашего сервера. Замените `{your-ip}` на IP-адрес вашего сервера и `{your-port}` на номер порта, настроенного для API в программе *MegaConnector*.

Если вы используете локальный HTTP/HTTPS сервер (например, когда программа MegaConnector и ваше приложение, такое как *MetaTrader*, установлены на одном компьютере), то вместо `{your-ip}` следует использовать `127.0.0.1`.

Для HTTP:  `http://{your-ip}:{your-port}/api/v1`
Для HTTPS: `https://{your-ip}:{your-port}/api/v1`

Убедитесь, что вы используете правильный протокол, соответствующий конфигурации SSL вашего сервера. Использование протокола HTTPS рекомендуется из-за его возможностей обеспечения безопасности. Активировать HTTPS можно в настройках программы MegaConnector.

Если вы используете MegaConnector на VPS (Виртуальный Частный Сервер), то по умолчанию он будет доступен по IP-адресу этого сервера в интернете. Однако, чтобы ограничить доступ к серверу так, чтобы он был доступен только локально (т.е. только с самого VPS), вам нужно будет настроить правила брандмауэра на этом VPS, чтобы разрешить трафик только с localhost (127.0.0.1).

## Аутентификация
Использование аутентификации **не является обязательным**, но **настоятельно рекомендуется** для обеспечения **безопасности** ваших данных, если использование API подразумевает доступ к MegaConnector на VPS сервере. Без аутентификации любой пользователь может получить доступ к API, что может привести к несанкционированному использованию или утечке важной информации. Активировать аутентификацию можно в настройках программы MegaConnector. В случае использования API в открытых сетях или для взаимодействия с внешними сервисами, аутентификация является критически важным элементом защиты.

Для доступа к API вы должны предоставить токен API в заголовке ваших запросов:

```plaintext
Authorization: Bearer YOUR_API_TOKEN
```

## Коды ошибок
* 200 OK - Запрос был успешным.
* 400 Bad Request - Запрос неверен или отсутствуют данные.
* 401 Unauthorized - Отсутствует или неверен токен API.
* 403 Forbidden - Токен API не имеет достаточных прав.
* 500 Internal Server Error - На сервере произошла ошибка.

## Конечные точки

### GET /ping
Проверяет статус API.

#### Запрос

```plaintext
GET https://127.0.0.1:8080/api/v1/ping
```

#### Ответ

Если запрос выполнен успешно, сервер MegaConnector сформирует ответ следующей структуры:

```json
{
    "ok": true,
    "result": {
        "can_trade": true,
        "can_view_info": true,
        "timestamp_ms": 1234567890
    }
}
```

* ok - статус запроса, тип bool.
* result - объект, содержащий информацию об ответе:
  * can_trade - флаг разрешения на торговлю, тип bool.
  * can_view_info - флаг разрешения на получение информации, тип bool.
  * timestamp_ms - метка времени в миллисекундах, тип int64.

При возникновении ошибки сервер вернёт ответ со следующей структурой, описывающей причину отказа:

```json
{
    "ok": false,
    "error": {
        "code": 403,
        "message": "Access denied. The token does not have trading permissions"
    }
}
```

* error - объект, содержащий информацию об ошибке:
  * code - код ошибки, тип int.
  * message - сообщение об ошибке, тип string.

### POST /trade_request
Дает команду MegaConnector открыть один или несколько сделок.

#### Запрос

```plaintext
POST https://127.0.0.1:8080/api/v1/trade_request
```

```json
{
    "trade_request": [
        {
            "account_id": 0,
            "symbol": "EURUSD",
            "user_data": "my data, example ID",
            "comment": "Opening trade in MetaTrader",
            "option": "SPRINT",
            "order": "BUY",
            "account": "REAL",
            "currency": "USD",
            "amount": 100.0,
            "refund": 0.01,
            "min_payout": 0.7,
            "duration": 60,
            "mm_parameters": {
                // Параметры мани-менеджмента
            }
        },
        // Другие объекты запроса
    ]
}
```

* trade_request - массив с запроcами на открытие сделок.
  * account_id - номер аккаунта в MegaConnector, на котором нужно открыть сделку. Так как аккаунтов может быть несколько, обязательно нужно указывать, какой именно нас интересует. Тип int.
  * symbol - имя символа, тип string. Сервер MegaConnector самостяотельно приводит имя символа к стандартному, если оно отличается от допустимых имен наличием лишних префиксов, суффиксов, разделительных знаков и пробелов.
  * (Опционально) user_data - Пользовательские данные, тип string. Их можно получить в ответе на запрос актуального состояния сделки или ее результата.
  * (Опционально) comment - Комментарий, тип string. Записывается в БД для каждой сделки.
  * option - Тип опциона, string. Может принимать пока два значения - SPRINT или CLASSIC.
  * order - Тип ордера, string. Может принимать два значения - BUY или SELL
  * (Опционально) account - тип аккаунта, string. Может принимать два значения - REAL или DEMO. Параметр нужен тогда, когда приложение самостоятельно задает тип аккаунта для сделки. На некоторых брокерах поддержка выбора аккаунта через торговый запрос может отсутствовать. Для универсального решения рекомендуется не использовать данный параметр в запросе, а настраивать демо или реальный счет на аккаунте через MegaConnector.
  * (Опционально) currency - валюта счета, string. Параметр используется только в связке с праметром account.
  * (Опционально) amount - размер сделки, тип double. Необходимо указать его, если не используется встроенная в MegaConnector система мани-менеджмента.
  * (Опционально) refund - размер возврата средств в случае убыточной сделки, тип double. Указать при необходимости. Поддерживается не всеми брокерами. При отсутствии поддержки брокером параметр будет проигнорирован.
  * (Опционально) min_payout - минимальный процент выплаты, тип double. Указать, если нужна фильтрация процентов выплат. Подходит для торговых систем без СКУ (Систему компенсации убытка). В случае использования СКУ рекомендуется использовать фильтр в программе MegaConnector.
  * (Опционально) duration - Время экспирации, тип int. Данный параметр нужен для типа опционов SPRINT или CLASSIC. Время нужно указывать в секундах. Для типа опционов CLASSIC время кратно 5-ти минутам.
  * (Опционально) expiry_time - Дата и время завершения опциона, тип int64. Данный параметр нужен только для типа опционов CLASSIC.Время нужно указывать в часовом поясе UTC.
  * (Опционально) mm_parameters - параметры мани-менеджмента. 

  

