# Документация Bridge REST API

## Описание
Этот API предоставляет возможность подключения торгового бота MegaConnector к ваши приложениям, в частности к MetaTrader посредством HTTP запросов. Он предназначен для разработчиков для автоматизации торговли бинарными опционами или фиксированными контрактами.

## Базовые URLs
Вы можете получить доступ к API, используя HTTP или HTTPS, в зависимости от конфигурации вашего сервера. 

Если вы используете локальный HTTP/HTTPS сервер (например, когда программа MegaConnector и ваше приложение, такое как *MetaTrader*, установлены на одном компьютере), то вместо `{your-ip}` следует использовать `127.0.0.1`.

* Для HTTP:  `http://{your-ip}:{your-port}/api/v1`
* Для HTTPS: `https://{your-ip}:{your-port}/api/v1`

Замените `{your-ip}` на IP-адрес вашего сервера и `{your-port}` на номер порта, настроенного для API в программе *MegaConnector*.

Убедитесь, что вы используете правильный протокол, соответствующий конфигурации SSL вашего сервера. Использование протокола HTTPS рекомендуется из-за его возможностей обеспечения безопасности. Активировать HTTPS можно в настройках программы MegaConnector.

Если вы используете MegaConnector на VPS (Виртуальный Частный Сервер), то по умолчанию он будет доступен по IP-адресу этого сервера в интернете. Однако, чтобы ограничить доступ к серверу так, чтобы он был доступен только локально (т.е. только с самого VPS), вам нужно будет настроить правила брандмауэра на этом VPS, чтобы разрешить трафик только с localhost (127.0.0.1).

## Аутентификация
Использование аутентификации **не является обязательным**, но **настоятельно рекомендуется** для обеспечения **безопасности** ваших данных, если использование API подразумевает доступ к MegaConnector на VPS сервере. Без аутентификации любой пользователь может получить доступ к API, что может привести к несанкционированному использованию или утечке важной информации. Активировать аутентификацию можно в настройках программы MegaConnector. В случае использования API в открытых сетях или для взаимодействия с внешними сервисами, аутентификация является критически важным элементом защиты.

Для доступа к API вы должны предоставить токен API в заголовке ваших запросов:

```plaintext
Authorization: Bearer YOUR_API_TOKEN
```

## Коды ошибок
* 200 OK - Запрос был успешным.
* 400 Bad Request - Запрос неверен или отсутствуют данные.
* 401 Unauthorized - Отсутствует или неверен токен API.
* 403 Forbidden - Токен API не имеет достаточных прав.
* 500 Internal Server Error - На сервере произошла ошибка.

## Конечные точки

### GET /ping
Проверяет статус API.

#### Запрос

```plaintext
GET https://127.0.0.1:8080/api/v1/ping
```

#### Ответ

Если запрос выполнен успешно, сервер MegaConnector сформирует ответ следующей структуры:

```json
{
    "ok": true,
    "result": {
        "can_trade": true,
        "can_view_info": true,
        "timestamp_ms": 1234567890
    }
}
```

* ok - статус запроса, тип bool.
* result - объект, содержащий информацию об ответе:
  * can_trade - флаг разрешения на торговлю, тип bool.
  * can_view_info - флаг разрешения на получение информации, тип bool.
  * timestamp_ms - метка времени в миллисекундах, тип int64.

При возникновении ошибки сервер вернёт ответ со следующей структурой, описывающей причину отказа:

```json
{
    "ok": false,
    "error": {
        "code": 403,
        "message": "Access denied. The token does not have trading permissions"
    }
}
```

* error - объект, содержащий информацию об ошибке:
  * code - код ошибки, тип int.
  * message - сообщение об ошибке, тип string.

### POST /place_trade
Дает команду MegaConnector открыть один или несколько сделок.

#### Запрос

```plaintext
POST https://127.0.0.1:8080/api/v1/place_trade
```

```json
{
    "trade_request": [
        {
            "account_id": 0,
            "symbol": "EURUSD",
            "user_data": "мои данные, например ID сделки в MetaTrader",
            "comment": "Открытие сделки в MetaTrader",
            "option": "SPRINT",
            "order": "BUY",
            "account": "REAL",
            "currency": "USD",
            "amount": 100.0,
            "refund": 0.01,
            "min_payout": 0.7,
            "duration": 60,
            "mm_parameters": {
                "type": "NONE"
            }
        }
    ]
}
```

* place_trade - Массив запросов на открытие сделок.
    * account_id - Идентификатор аккаунта в MegaConnector, на котором нужно открыть сделку. Тип: int.
    * symbol - Название символа. MegaConnector автоматически приводит его к стандартному виду, удаляя лишние префиксы, суффиксы, разделители и пробелы. Тип: string.
    * user_data (опционально) - Пользовательские данные, которые можно использовать для идентификации сделки. Тип: string.
    * comment (опционально) - Комментарий к сделке, который будет записан в базе данных. Тип: string.
    * option - Тип опциона, может быть SPRINT или CLASSIC. Тип: string.
    * order - Тип ордера, может быть BUY или SELL. Тип: string.
    * account (опционально) - Тип аккаунта, может быть REAL или DEMO. Параметр нужен только тогда, когда пользовательское приложение самостоятельно задает тип аккаунта для сделки. На некоторых брокерах поддержка выбора аккаунта через торговый запрос может отсутствовать. Для универсального решения рекомендуется не использовать данный параметр в запросе, а настраивать демо или реальный счет на аккаунте через MegaConnector. Тип: string.
    * currency (опционально) - Валюта счета. Параметр используется только в связке с праметром account. Тип: string.
    * amount (опционально) - Размер сделки. Необходимо указать, если не используется встроенная в MegaConnector система мани-менеджмента. Тип: double.
    * refund (опционально) - Размер возврата в случае убыточной сделки. Диапазон от 0.0 до 1.0, где 1.0 соответствует 100%. Поддерживается не всеми брокерами. При отсутствии возврата у брокера параметр будет проигнорирован. Тип: double.
    * min_payout (опционально) - Минимальный процент выплаты. Диапазон от 0.0 до 1.0, где 1.0 соответствует 100%. Указать, если нужна фильтрация процентов выплат. Подходит для торговых систем без СКУ (Система Компенсации Убытков). В случае использования СКУ рекомендуется использовать фильтр в программе MegaConnector. Тип: double.
    * duration (опционально) - Продолжительность сделки в секундах. Для CLASSIC типа опционов время должно быть кратно 5 минутам. Тип: int.
    * expiry_time (опционально) - Время истечения опциона, часовой пояс UTC. **Данный параметр нужен только для типа опционов CLASSIC.** Тип: int64.
    * mm_parameters (опционально) - Параметры мани-менеджмента.
        * type (опционально) - Тип системы мани-менеджмента, на данный момент не поддерживается, поэтому рекомендуется использовать значение "NONE". Тип: string.
        * winrate (опционально) - Винрейт сигнала. Диапазон от 0.0 до 1.0, где 1.0 соответствует 100%. Параметр нужен для Критерия Келли и для сортировки сигналов. Тип: double.
        * score (опционально) - Оценка сигнала. Параметр нужен для сортировки сигналов.

Убедитесь, что все опциональные поля используются в соответствии с требованиями вашей торговой стратегии и спецификациями брокера.
